using com.fscigliano.VerticalShootEmUp.Core;
using com.fscigliano.VerticalShootEmUp.GameActors;
using UnityEngine;

namespace com.fscigliano.VerticalShootEmUp.GameActorFeatures
{
    /// <summary>
    /// Product Name:    VerticalShootEmUp
    /// Developers:      Franco Scigliano
    /// Description:     Makes the avatar invulnerable until an amount of time pass.
    /// Changelog:       
    /// </summary>
    public class AvatarInvulnerability : GameActorFeatureBase
    {
        [SerializeField] protected GameConfigAsset _config;
        [SerializeField] protected SpriteRenderer _sprite;
        [SerializeField] protected string _vulnerableLayer;
        [SerializeField] protected string _invulnerableLayer;

        private bool invulnerable = false;

        private void OnEnable()
        {
            _gameActor.gameObject.layer = LayerMask.NameToLayer(_invulnerableLayer);
            invulnerable = true;
            Color c = _sprite.color;
            c.a = 0.5f;
            _sprite.color = c;
        }

        public override void DoFixedUpdate(GameActor a, float t)
        {
            if (invulnerable && t >= _config.AvatarInvulnerabilityTime)
            {
                _gameActor.gameObject.layer = LayerMask.NameToLayer(_vulnerableLayer);
                invulnerable = false;
                Color c = _sprite.color;
                c.a = 1;
                _sprite.color = c;
            }
        }
    }
}